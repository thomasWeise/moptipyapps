"""Test loading and validity of bin packing 2D instances."""


from moptipy.utils.types import type_error

from moptipyapps.binpacking2d.instance import Instance


def check_instance(inst: Instance, name: str | None = None) -> None:
    """
    Check an instance, throw an error if it is wrong.

    :param inst: the instance
    :param name: the instance name, optional
    """
    if not isinstance(inst, Instance):
        raise type_error(inst, "inst", Instance)
    if name is not None:
        if not isinstance(name, str):
            raise type_error(name, "name", str)
        if inst.name != name:
            raise ValueError(f"inst.name={inst.name!r} != {name!r}!")


def test_load_all_from_resources() -> None:
    """Test loading the all the instances from resources."""
    count: int = 0
    for name in Instance.list_resources():
        check_instance(Instance.from_resource(name), name)
        count += 1
    if count != 557:
        raise ValueError(f"Excepted 557 instances, got {count}.")


#: These are known lower bounds for the oriented 2D Bin Packing Problem.
#: Since these bounds are for the *oriented* problem that does not permit
#: item rotation, they must be >= than the computed bounds for the problem
#: where rotations are permitted.
#: At the present time, they stem from
#: http://www.or.deis.unibo.it/research_pages/ORinstances/soluz_2dbp.htm
__KNOWN_LOWER_BOUNDS_ORIENTED: dict[str, int] = {
    "cl01_020_01": 8, "cl01_020_02": 5, "cl01_020_03": 9, "cl01_020_04": 6,
    "cl01_020_05": 6, "cl01_020_06": 9, "cl01_020_07": 6, "cl01_020_08": 6,
    "cl01_020_09": 8, "cl01_020_10": 8, "cl01_040_01": 10, "cl01_040_02": 12,
    "cl01_040_03": 17, "cl01_040_04": 14, "cl01_040_05": 15,
    "cl01_040_06": 14, "cl01_040_07": 11, "cl01_040_08": 19,
    "cl01_040_09": 11, "cl01_040_10": 11, "cl01_060_01": 22,
    "cl01_060_02": 18, "cl01_060_03": 21, "cl01_060_04": 22,
    "cl01_060_05": 19, "cl01_060_06": 17, "cl01_060_07": 15,
    "cl01_060_08": 21, "cl01_060_09": 18, "cl01_060_10": 24,
    "cl01_080_01": 24, "cl01_080_02": 26, "cl01_080_03": 27,
    "cl01_080_04": 27, "cl01_080_05": 26, "cl01_080_06": 28,
    "cl01_080_07": 31, "cl01_080_08": 29, "cl01_080_09": 30,
    "cl01_080_10": 26, "cl01_100_01": 28, "cl01_100_02": 31,
    "cl01_100_03": 29, "cl01_100_04": 30, "cl01_100_05": 32,
    "cl01_100_06": 37, "cl01_100_07": 28, "cl01_100_08": 33,
    "cl01_100_09": 31, "cl01_100_10": 38, "cl02_020_01": 1, "cl02_020_02": 1,
    "cl02_020_03": 1, "cl02_020_04": 1, "cl02_020_05": 1, "cl02_020_06": 1,
    "cl02_020_07": 1, "cl02_020_08": 1, "cl02_020_09": 1, "cl02_020_10": 1,
    "cl02_040_01": 1, "cl02_040_02": 2, "cl02_040_03": 2, "cl02_040_04": 2,
    "cl02_040_05": 2, "cl02_040_06": 2, "cl02_040_07": 2, "cl02_040_08": 2,
    "cl02_040_09": 2, "cl02_040_10": 2, "cl02_060_01": 3, "cl02_060_02": 2,
    "cl02_060_03": 3, "cl02_060_04": 3, "cl02_060_05": 2, "cl02_060_06": 2,
    "cl02_060_07": 2, "cl02_060_08": 3, "cl02_060_09": 2, "cl02_060_10": 3,
    "cl02_080_01": 3, "cl02_080_02": 3, "cl02_080_03": 3, "cl02_080_04": 3,
    "cl02_080_05": 3, "cl02_080_06": 3, "cl02_080_07": 3, "cl02_080_08": 3,
    "cl02_080_09": 4, "cl02_080_10": 3, "cl02_100_01": 4, "cl02_100_02": 4,
    "cl02_100_03": 3, "cl02_100_04": 4, "cl02_100_05": 4, "cl02_100_06": 4,
    "cl02_100_07": 4, "cl02_100_08": 4, "cl02_100_09": 4, "cl02_100_10": 4,
    "cl03_020_01": 6, "cl03_020_02": 3, "cl03_020_03": 6, "cl03_020_04": 4,
    "cl03_020_05": 4, "cl03_020_06": 7, "cl03_020_07": 5, "cl03_020_08": 4,
    "cl03_020_09": 5, "cl03_020_10": 7, "cl03_040_01": 6, "cl03_040_02": 8,
    "cl03_040_03": 11, "cl03_040_04": 10, "cl03_040_05": 12,
    "cl03_040_06": 10, "cl03_040_07": 8, "cl03_040_08": 13, "cl03_040_09": 7,
    "cl03_040_10": 7, "cl03_060_01": 16, "cl03_060_02": 12, "cl03_060_03": 13,
    "cl03_060_04": 14, "cl03_060_05": 12, "cl03_060_06": 12,
    "cl03_060_07": 11, "cl03_060_08": 15, "cl03_060_09": 13,
    "cl03_060_10": 18, "cl03_080_01": 17, "cl03_080_02": 18,
    "cl03_080_03": 17, "cl03_080_04": 18, "cl03_080_05": 16,
    "cl03_080_06": 20, "cl03_080_07": 20, "cl03_080_08": 22,
    "cl03_080_09": 21, "cl03_080_10": 18, "cl03_100_01": 19,
    "cl03_100_02": 22, "cl03_100_03": 18, "cl03_100_04": 20,
    "cl03_100_05": 22, "cl03_100_06": 27, "cl03_100_07": 20,
    "cl03_100_08": 23, "cl03_100_09": 21, "cl03_100_10": 29, "cl04_020_01": 1,
    "cl04_020_02": 1, "cl04_020_03": 1, "cl04_020_04": 1, "cl04_020_05": 1,
    "cl04_020_06": 1, "cl04_020_07": 1, "cl04_020_08": 1, "cl04_020_09": 1,
    "cl04_020_10": 1, "cl04_040_01": 1, "cl04_040_02": 2, "cl04_040_03": 2,
    "cl04_040_04": 2, "cl04_040_05": 2, "cl04_040_06": 2, "cl04_040_07": 2,
    "cl04_040_08": 2, "cl04_040_09": 2, "cl04_040_10": 2, "cl04_060_01": 3,
    "cl04_060_02": 2, "cl04_060_03": 2, "cl04_060_04": 2, "cl04_060_05": 2,
    "cl04_060_06": 2, "cl04_060_07": 2, "cl04_060_08": 3, "cl04_060_09": 2,
    "cl04_060_10": 3, "cl04_080_01": 3, "cl04_080_02": 3, "cl04_080_03": 3,
    "cl04_080_04": 3, "cl04_080_05": 3, "cl04_080_06": 3, "cl04_080_07": 3,
    "cl04_080_08": 3, "cl04_080_09": 3, "cl04_080_10": 3, "cl04_100_01": 3,
    "cl04_100_02": 4, "cl04_100_03": 3, "cl04_100_04": 4, "cl04_100_05": 4,
    "cl04_100_06": 4, "cl04_100_07": 3, "cl04_100_08": 4, "cl04_100_09": 4,
    "cl04_100_10": 4, "cl05_020_01": 8, "cl05_020_02": 5, "cl05_020_03": 7,
    "cl05_020_04": 5, "cl05_020_05": 5, "cl05_020_06": 9, "cl05_020_07": 6,
    "cl05_020_08": 5, "cl05_020_09": 7, "cl05_020_10": 8, "cl05_040_01": 8,
    "cl05_040_02": 10, "cl05_040_03": 15, "cl05_040_04": 13,
    "cl05_040_05": 14, "cl05_040_06": 12, "cl05_040_07": 10,
    "cl05_040_08": 17, "cl05_040_09": 10, "cl05_040_10": 10,
    "cl05_060_01": 20, "cl05_060_02": 17, "cl05_060_03": 19,
    "cl05_060_04": 20, "cl05_060_05": 15, "cl05_060_06": 15,
    "cl05_060_07": 14, "cl05_060_08": 19, "cl05_060_09": 16,
    "cl05_060_10": 24, "cl05_080_01": 22, "cl05_080_02": 22,
    "cl05_080_03": 24, "cl05_080_04": 25, "cl05_080_05": 22,
    "cl05_080_06": 25, "cl05_080_07": 27, "cl05_080_08": 26,
    "cl05_080_09": 26, "cl05_080_10": 22, "cl05_100_01": 23,
    "cl05_100_02": 28, "cl05_100_03": 24, "cl05_100_04": 26,
    "cl05_100_05": 28, "cl05_100_06": 34, "cl05_100_07": 25,
    "cl05_100_08": 29, "cl05_100_09": 27, "cl05_100_10": 35, "cl06_020_01": 1,
    "cl06_020_02": 1, "cl06_020_03": 1, "cl06_020_04": 1, "cl06_020_05": 1,
    "cl06_020_06": 1, "cl06_020_07": 1, "cl06_020_08": 1, "cl06_020_09": 1,
    "cl06_020_10": 1, "cl06_040_01": 1, "cl06_040_02": 1, "cl06_040_03": 2,
    "cl06_040_04": 2, "cl06_040_05": 2, "cl06_040_06": 1, "cl06_040_07": 2,
    "cl06_040_08": 2, "cl06_040_09": 1, "cl06_040_10": 1, "cl06_060_01": 2,
    "cl06_060_02": 2, "cl06_060_03": 2, "cl06_060_04": 2, "cl06_060_05": 2,
    "cl06_060_06": 2, "cl06_060_07": 2, "cl06_060_08": 2, "cl06_060_09": 2,
    "cl06_060_10": 3, "cl06_080_01": 3, "cl06_080_02": 3, "cl06_080_03": 3,
    "cl06_080_04": 3, "cl06_080_05": 3, "cl06_080_06": 3, "cl06_080_07": 3,
    "cl06_080_08": 3, "cl06_080_09": 3, "cl06_080_10": 3, "cl06_100_01": 3,
    "cl06_100_02": 3, "cl06_100_03": 3, "cl06_100_04": 3, "cl06_100_05": 3,
    "cl06_100_06": 4, "cl06_100_07": 3, "cl06_100_08": 3, "cl06_100_09": 3,
    "cl06_100_10": 4, "cl07_020_01": 5, "cl07_020_02": 5, "cl07_020_03": 5,
    "cl07_020_04": 7, "cl07_020_05": 6, "cl07_020_06": 6, "cl07_020_07": 4,
    "cl07_020_08": 7, "cl07_020_09": 6, "cl07_020_10": 4, "cl07_040_01": 10,
    "cl07_040_02": 12, "cl07_040_03": 9, "cl07_040_04": 14, "cl07_040_05": 10,
    "cl07_040_06": 11, "cl07_040_07": 11, "cl07_040_08": 11, "cl07_040_09": 8,
    "cl07_040_10": 13, "cl07_060_01": 17, "cl07_060_02": 14,
    "cl07_060_03": 17, "cl07_060_04": 15, "cl07_060_05": 14,
    "cl07_060_06": 15, "cl07_060_07": 15, "cl07_060_08": 17,
    "cl07_060_09": 14, "cl07_060_10": 18, "cl07_080_01": 20,
    "cl07_080_02": 25, "cl07_080_03": 20, "cl07_080_04": 21,
    "cl07_080_05": 23, "cl07_080_06": 22, "cl07_080_07": 24,
    "cl07_080_08": 22, "cl07_080_09": 23, "cl07_080_10": 24,
    "cl07_100_01": 27, "cl07_100_02": 27, "cl07_100_03": 24,
    "cl07_100_04": 26, "cl07_100_05": 25, "cl07_100_06": 28,
    "cl07_100_07": 27, "cl07_100_08": 29, "cl07_100_09": 25,
    "cl07_100_10": 31, "cl08_020_01": 6, "cl08_020_02": 7, "cl08_020_03": 5,
    "cl08_020_04": 7, "cl08_020_05": 6, "cl08_020_06": 6, "cl08_020_07": 5,
    "cl08_020_08": 5, "cl08_020_09": 7, "cl08_020_10": 4, "cl08_040_01": 11,
    "cl08_040_02": 13, "cl08_040_03": 11, "cl08_040_04": 12, "cl08_040_05": 9,
    "cl08_040_06": 12, "cl08_040_07": 11, "cl08_040_08": 11, "cl08_040_09": 9,
    "cl08_040_10": 13, "cl08_060_01": 17, "cl08_060_02": 17,
    "cl08_060_03": 16, "cl08_060_04": 15, "cl08_060_05": 14,
    "cl08_060_06": 15, "cl08_060_07": 14, "cl08_060_08": 17,
    "cl08_060_09": 16, "cl08_060_10": 18, "cl08_080_01": 22,
    "cl08_080_02": 24, "cl08_080_03": 20, "cl08_080_04": 20,
    "cl08_080_05": 26, "cl08_080_06": 22, "cl08_080_07": 22,
    "cl08_080_08": 22, "cl08_080_09": 21, "cl08_080_10": 24,
    "cl08_100_01": 26, "cl08_100_02": 27, "cl08_100_03": 24,
    "cl08_100_04": 30, "cl08_100_05": 29, "cl08_100_06": 26,
    "cl08_100_07": 25, "cl08_100_08": 28, "cl08_100_09": 27,
    "cl08_100_10": 32, "cl09_020_01": 19, "cl09_020_02": 13,
    "cl09_020_03": 14, "cl09_020_04": 16, "cl09_020_05": 16,
    "cl09_020_06": 14, "cl09_020_07": 9, "cl09_020_08": 14, "cl09_020_09": 15,
    "cl09_020_10": 13, "cl09_040_01": 25, "cl09_040_02": 32,
    "cl09_040_03": 29, "cl09_040_04": 31, "cl09_040_05": 27,
    "cl09_040_06": 29, "cl09_040_07": 24, "cl09_040_08": 26,
    "cl09_040_09": 21, "cl09_040_10": 34, "cl09_060_01": 46,
    "cl09_060_02": 45, "cl09_060_03": 46, "cl09_060_04": 44,
    "cl09_060_05": 41, "cl09_060_06": 37, "cl09_060_07": 41,
    "cl09_060_08": 47, "cl09_060_09": 45, "cl09_060_10": 45,
    "cl09_080_01": 59, "cl09_080_02": 58, "cl09_080_03": 57,
    "cl09_080_04": 53, "cl09_080_05": 62, "cl09_080_06": 62,
    "cl09_080_07": 59, "cl09_080_08": 58, "cl09_080_09": 49,
    "cl09_080_10": 60, "cl09_100_01": 71, "cl09_100_02": 64,
    "cl09_100_03": 68, "cl09_100_04": 78, "cl09_100_05": 65,
    "cl09_100_06": 71, "cl09_100_07": 66, "cl09_100_08": 74,
    "cl09_100_09": 66, "cl09_100_10": 72, "cl10_020_01": 6, "cl10_020_02": 3,
    "cl10_020_03": 4, "cl10_020_04": 5, "cl10_020_05": 4, "cl10_020_06": 4,
    "cl10_020_07": 5, "cl10_020_08": 3, "cl10_020_09": 5, "cl10_020_10": 3,
    "cl10_040_01": 8, "cl10_040_02": 8, "cl10_040_03": 9, "cl10_040_04": 6,
    "cl10_040_05": 6, "cl10_040_06": 6, "cl10_040_07": 7, "cl10_040_08": 7,
    "cl10_040_09": 8, "cl10_040_10": 9, "cl10_060_01": 11, "cl10_060_02": 12,
    "cl10_060_03": 11, "cl10_060_04": 7, "cl10_060_05": 8, "cl10_060_06": 13,
    "cl10_060_07": 10, "cl10_060_08": 10, "cl10_060_09": 8, "cl10_060_10": 8,
    "cl10_080_01": 12, "cl10_080_02": 10, "cl10_080_03": 11,
    "cl10_080_04": 13, "cl10_080_05": 14, "cl10_080_06": 13,
    "cl10_080_07": 14, "cl10_080_08": 10, "cl10_080_09": 12,
    "cl10_080_10": 14, "cl10_100_01": 14, "cl10_100_02": 15,
    "cl10_100_03": 15, "cl10_100_04": 17, "cl10_100_05": 17,
    "cl10_100_06": 13, "cl10_100_07": 13, "cl10_100_08": 18,
    "cl10_100_09": 16, "cl10_100_10": 15,
}


def test_lower_bounds() -> None:
    """Test the lower bounds."""
    for inst_name in Instance.list_resources():
        if inst_name in __KNOWN_LOWER_BOUNDS_ORIENTED:
            lower_bound = Instance.from_resource(inst_name).lower_bound_bins
            assert lower_bound <= __KNOWN_LOWER_BOUNDS_ORIENTED[inst_name]
