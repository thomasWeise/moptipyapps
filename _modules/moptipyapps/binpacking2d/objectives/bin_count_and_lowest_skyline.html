<!doctype html><html data-content_root=../../../../ lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0"name=viewport><title>moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline — moptipyapps 0.8.79 documentation</title><link href="../../../../_static/pygments.css?v=b86133f3"rel=stylesheet><link href="../../../../_static/bizstyle.css?v=5283bb3d"rel=stylesheet><script src="../../../../_static/documentation_options.js?v=38375235"></script><script src="../../../../_static/doctools.js?v=9bcbadda"></script><script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script><script src=../../../../_static/bizstyle.js></script><link href=https://thomasweise.github.io/moptipyapps/_modules/moptipyapps/binpacking2d/objectives/bin_count_and_lowest_skyline.html rel=canonical><link href=../../../../genindex.html rel=index title=Index><link href=../../../../search.html rel=search title=Search><meta content="width=device-width,initial-scale=1.0"name=viewport><body><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"accesskey=I href=../../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../../index.html>moptipyapps 0.8.79 documentation</a> »<li class="nav-item nav-item-1"><a accesskey=U href=../../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline</a></ul></div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><h1>Source code for moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline</h1><div class=highlight><pre>
<span></span><span class=sd>"""</span>
<span class=sd>An objective function indirectly minimizing the number of bins in packings.</span>

<span class=sd>This objective function minimizes the number of bins and maximizes the</span>
<span class=sd>"useable" space in any bin.</span>

<span class=sd>Which space is actually useful for our encodings? Let's say we have filled</span>
<span class=sd>a bin to a certain degree and somewhere there is a "hole" in the filled area,</span>
<span class=sd>but this hole is covered by another object. The area of the hole is not used,</span>
<span class=sd>but it also cannot be used anymore. The area that we can definitely use is the</span>
<span class=sd>area above the "skyline" of the objects in the bin. The skyline at any</span>
<span class=sd>horizontal `x` coordinate be the highest border of any object that intersects</span>
<span class=sd>with `x` horizontally. In other words, it is the `y` value at and above which</span>
<span class=sd>no other object is located at this `x` coordinate. The area below the skyline</span>
<span class=sd>cannot be used anymore. The area above the skyline can.</span>

<span class=sd>If we minimize the area below the skyline in the very last bin, then this will</span>
<span class=sd>a similar impact as minimizing the overall object area in the last bin (see</span>
<span class=sd>:mod:`~moptipyapps.binpacking2d.objectives.bin_count_and_last_small`). We push</span>
<span class=sd>the skyline lower and lower and, if we are lucky, the last bin eventually</span>
<span class=sd>becomes empty. This is done with the objective</span>
<span class=sd>:mod:`~moptipyapps.binpacking2d.objectives.bin_count_and_last_skyline`.</span>

<span class=sd>But we could also minimize the area under the skylines in the other bins.</span>
<span class=sd>Because a) if we can get any skyline in any bin to become 0, then this bin</span>
<span class=sd>disappears and b) if we can free up space in the bins by lowering the</span>
<span class=sd>skylines, then we have a better chance to move an object from the *next* bin</span>
<span class=sd>forward into that bin, which increases the chance to make that bin empty.</span>

<span class=sd>In this objective function, we therefore use the smallest skyline area over</span>
<span class=sd>all bins to distinguish between packings of the same number of bins.</span>
<span class=sd>For all intents and purposes, it has the same lower and upper bound as the</span>
<span class=sd>:mod:`~moptipyapps.binpacking2d.objectives.bin_count_and_last_small`</span>
<span class=sd>objective.</span>
<span class=sd>"""</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Final</span>

<span class=kn>import</span><span class=w> </span><span class=nn>numba</span>  <span class=c1># type: ignore</span>
<span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>

<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.binpacking2d.instance</span><span class=w> </span><span class=kn>import</span> <span class=n>Instance</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.binpacking2d.objectives.bin_count_and_last_small</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>BinCountAndLastSmall</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.binpacking2d.packing</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>IDX_BIN</span><span class=p>,</span>
    <span class=n>IDX_LEFT_X</span><span class=p>,</span>
    <span class=n>IDX_RIGHT_X</span><span class=p>,</span>
    <span class=n>IDX_TOP_Y</span><span class=p>,</span>
<span class=p>)</span>


<div class=viewcode-block id=bin_count_and_lowest_skyline>
<a class=viewcode-back href=../../../../moptipyapps.binpacking2d.objectives.html#moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline.bin_count_and_lowest_skyline>[docs]</a>
<span class=nd>@numba</span><span class=o>.</span><span class=n>njit</span><span class=p>(</span><span class=n>cache</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>inline</span><span class=o>=</span><span class=s2>"always"</span><span class=p>,</span> <span class=n>fastmath</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>boundscheck</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>bin_count_and_lowest_skyline</span><span class=p>(</span><span class=n>y</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>bin_width</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
                                 <span class=n>bin_height</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span><span class=p>:</span>
<span class=w>    </span><span class=sd>"""</span>
<span class=sd>    Compute the bin count-1 times the bin size + the space below the skyline.</span>

<span class=sd>    :param y: the packing</span>
<span class=sd>    :param bin_width: the bin width</span>
<span class=sd>    :param bin_height: the bin height</span>
<span class=sd>    :return: the objective value</span>

<span class=sd>    >>> 10*0 + 10*20 + 10*30 + 10*40 + 10*0</span>
<span class=sd>    900</span>
<span class=sd>    >>> bin_count_and_lowest_skyline(np.array([[1, 1, 10, 10, 20, 20],</span>
<span class=sd>    ...                                        [1, 1, 30, 30, 40, 40],</span>
<span class=sd>    ...                                        [1, 1, 20, 20, 30, 30]], int),</span>
<span class=sd>    ...                              50, 50)</span>
<span class=sd>    900</span>
<span class=sd>    >>> 5 * 0 + 5 * 10 + 10 * 20 + 5 * 10 + 25 * 0</span>
<span class=sd>    300</span>
<span class=sd>    >>> bin_count_and_lowest_skyline(np.array([[1, 1,  5,  0, 15, 10],</span>
<span class=sd>    ...                                        [1, 1, 10, 10, 20, 20],</span>
<span class=sd>    ...                                        [1, 1, 15,  0, 25, 10]], int),</span>
<span class=sd>    ...                              50, 50)</span>
<span class=sd>    300</span>
<span class=sd>    >>> 50*50 + min(5*0 + 10*10 + 10*10 + 25*0, 10*0 + 10*20 + 30*0)</span>
<span class=sd>    2700</span>
<span class=sd>    >>> bin_count_and_lowest_skyline(np.array([[1, 1,  5,  0, 15, 10],</span>
<span class=sd>    ...                                        [1, 2, 10, 10, 20, 20],</span>
<span class=sd>    ...                                        [1, 1, 15,  0, 25, 10]], int),</span>
<span class=sd>    ...                              50, 50)</span>
<span class=sd>    2700</span>
<span class=sd>    >>> 5 * 0 + 5 * 10 + 3 * 20 + (50 - 13) * 25</span>
<span class=sd>    1035</span>
<span class=sd>    >>> bin_count_and_lowest_skyline(np.array([[1, 1,  5,  0, 15, 10],</span>
<span class=sd>    ...                                        [1, 1, 10, 10, 20, 20],</span>
<span class=sd>    ...                                        [1, 1, 15,  0, 25, 10],</span>
<span class=sd>    ...                                        [2, 1, 13, 20, 50, 25]], int),</span>
<span class=sd>    ...                              50, 50)</span>
<span class=sd>    1035</span>
<span class=sd>    >>> 2500*3 + min(10*10, 20*20, 25*10, 50*25)</span>
<span class=sd>    7600</span>
<span class=sd>    >>> bin_count_and_lowest_skyline(np.array([[1, 1, 0, 0, 10, 10],</span>
<span class=sd>    ...                                        [2, 2, 0, 0, 20, 20],</span>
<span class=sd>    ...                                        [3, 3, 0, 0, 25, 10],</span>
<span class=sd>    ...                                        [4, 4, 0, 0, 50, 25]], int),</span>
<span class=sd>    ...                              50, 50)</span>
<span class=sd>    7600</span>
<span class=sd>    """</span>
    <span class=n>bins</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>y</span><span class=p>[:,</span> <span class=n>IDX_BIN</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>())</span>
    <span class=n>len_y</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
    <span class=n>bin_size</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>bin_height</span> <span class=o>*</span> <span class=n>bin_width</span>
    <span class=n>min_area_under_skyline</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>bin_size</span>

    <span class=k>for</span> <span class=n>use_bin</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>bins</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
        <span class=n>cur_left</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>area_under_skyline</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>while</span> <span class=n>cur_left</span> <span class=o><</span> <span class=n>bin_width</span><span class=p>:</span>
            <span class=n>use_right</span> <span class=o>=</span> <span class=n>next_left</span> <span class=o>=</span> <span class=n>bin_width</span>
            <span class=n>use_top</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>len_y</span><span class=p>):</span>
                <span class=k>if</span> <span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>IDX_BIN</span><span class=p>]</span> <span class=o>!=</span> <span class=n>use_bin</span><span class=p>:</span>
                    <span class=k>continue</span>
                <span class=n>left</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>IDX_LEFT_X</span><span class=p>])</span>
                <span class=n>right</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>IDX_RIGHT_X</span><span class=p>])</span>
                <span class=n>top</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>IDX_TOP_Y</span><span class=p>])</span>
                <span class=k>if</span> <span class=n>left</span> <span class=o><=</span> <span class=n>cur_left</span> <span class=o><</span> <span class=n>right</span> <span class=ow>and</span> <span class=n>top</span> <span class=o>></span> <span class=n>use_top</span><span class=p>:</span>
                    <span class=n>use_top</span> <span class=o>=</span> <span class=n>top</span>
                    <span class=n>use_right</span> <span class=o>=</span> <span class=n>right</span>
                <span class=k>if</span> <span class=n>cur_left</span> <span class=o><</span> <span class=n>left</span> <span class=o><</span> <span class=n>next_left</span><span class=p>:</span>
                    <span class=n>next_left</span> <span class=o>=</span> <span class=n>left</span>

            <span class=n>use_right</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>use_right</span><span class=p>,</span> <span class=n>next_left</span><span class=p>)</span>
            <span class=n>area_under_skyline</span> <span class=o>+=</span> <span class=p>(</span><span class=n>use_right</span> <span class=o>-</span> <span class=n>cur_left</span><span class=p>)</span> <span class=o>*</span> <span class=n>use_top</span>
            <span class=n>cur_left</span> <span class=o>=</span> <span class=n>use_right</span>
        <span class=n>min_area_under_skyline</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>min_area_under_skyline</span><span class=p>,</span>
                                     <span class=n>area_under_skyline</span><span class=p>)</span>
    <span class=k>return</span> <span class=p>((</span><span class=n>bins</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>bin_size</span><span class=p>)</span> <span class=o>+</span> <span class=n>min_area_under_skyline</span></div>



<div class=viewcode-block id=BinCountAndLowestSkyline>
<a class=viewcode-back href=../../../../moptipyapps.binpacking2d.objectives.html#moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline.BinCountAndLowestSkyline>[docs]</a>
<span class=k>class</span><span class=w> </span><span class=nc>BinCountAndLowestSkyline</span><span class=p>(</span><span class=n>BinCountAndLastSmall</span><span class=p>):</span>
<span class=w>    </span><span class=sd>"""Compute the number of bins and the largest useful area."""</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>:</span> <span class=n>Instance</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Initialize the objective function.</span>

<span class=sd>        :param instance: the instance to load the bounds from</span>
<span class=sd>        """</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
        <span class=c1>#: the bin width</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__bin_width</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>bin_width</span>
        <span class=c1>#: the bin height</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__bin_height</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>bin_height</span>

<div class=viewcode-block id=BinCountAndLowestSkyline.evaluate>
<a class=viewcode-back href=../../../../moptipyapps.binpacking2d.objectives.html#moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline.BinCountAndLowestSkyline.evaluate>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>evaluate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span> <span class=o>-></span> <span class=nb>int</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Evaluate the objective function.</span>

<span class=sd>        :param x: the solution</span>
<span class=sd>        :return: the bin size and last-bin-small-area factor</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=n>bin_count_and_lowest_skyline</span><span class=p>(</span>
            <span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__bin_width</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__bin_height</span><span class=p>)</span></div>


    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Get the name of the bins objective function.</span>

<span class=sd>        :return: `binCountAndLowestSkyline`</span>
<span class=sd>        :retval "binCountAndLowestSkyline": always</span>
<span class=sd>        """</span>
        <span class=k>return</span> <span class=s2>"binCountAndLowestSkyline"</span></div>

</pre></div><div class=clearer></div></div></div></div><div aria-label=Main class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><search id=searchbox role=search style=display:none> <h3 id=searchlabel>Quick search</h3> <div class=searchformwrapper><form action=../../../../search.html class=search><input aria-labelledby=searchlabel autocapitalize=off autocomplete=off autocorrect=off name=q spellcheck=false><input type=submit value=Go></form></div> </search><script>document.getElementById(`searchbox`).style.display=`block`;</script></div></div><div class=clearer></div></div><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"href=../../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../../index.html>moptipyapps 0.8.79 documentation</a> »<li class="nav-item nav-item-1"><a href=../../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>moptipyapps.binpacking2d.objectives.bin_count_and_lowest_skyline</a></ul></div><div class=footer role=contentinfo>© Copyright 2023-2025, Thomas Weise.</div>
