<!doctype html><html data-content_root=../../../ lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0"name=viewport><title>moptipyapps.prodsched.rop_simulation — moptipyapps 0.8.79 documentation</title><link href="../../../_static/pygments.css?v=b86133f3"rel=stylesheet><link href="../../../_static/bizstyle.css?v=5283bb3d"rel=stylesheet><script src="../../../_static/documentation_options.js?v=38375235"></script><script src="../../../_static/doctools.js?v=9bcbadda"></script><script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script><script src=../../../_static/bizstyle.js></script><link href=https://thomasweise.github.io/moptipyapps/_modules/moptipyapps/prodsched/rop_simulation.html rel=canonical><link href=../../../genindex.html rel=index title=Index><link href=../../../search.html rel=search title=Search><meta content="width=device-width,initial-scale=1.0"name=viewport><body><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"accesskey=I href=../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../index.html>moptipyapps 0.8.79 documentation</a> »<li class="nav-item nav-item-1"><a accesskey=U href=../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>moptipyapps.prodsched.rop_simulation</a></ul></div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><h1>Source code for moptipyapps.prodsched.rop_simulation</h1><div class=highlight><pre>
<span></span><span class=sd>"""</span>
<span class=sd>A re-order-point-based simulation.</span>

<span class=sd>Re-Order-Point (ROP) scenarios are such that for each product, a value `X` is</span>
<span class=sd>provided. Once there are no more than `X` elements of that product in the</span>
<span class=sd>warehouse, one new unit is ordered to be produced.</span>
<span class=sd>Therefore, we have `n_products` such `X` values.</span>

<span class=sd>ROP-based simulations extend the basic behavior of the class</span>
<span class=sd>:class:`~moptipyapps.prodsched.simulation.Simulation` to re-order production</span>
<span class=sd>based on ROPs.</span>

<span class=sd>>>> from moptipyapps.prodsched.simulation import PrintingListener</span>
<span class=sd>>>> instance = Instance(</span>
<span class=sd>...     name="test1", n_products=2, n_customers=4, n_stations=2, n_demands=4,</span>
<span class=sd>...     time_end_warmup=3000, time_end_measure=10000,</span>
<span class=sd>...     routes=[[0, 1], [1, 0]],</span>
<span class=sd>...     demands=[Demand(arrival=100, deadline=100, demand_id=0,</span>
<span class=sd>...                     customer_id=0, product_id=0, amount=1, measure=False),</span>
<span class=sd>...              Demand(arrival=3100, deadline=3100, demand_id=1,</span>
<span class=sd>...                     customer_id=1, product_id=0, amount=1, measure=True),</span>
<span class=sd>...              Demand(arrival=500, deadline=500, demand_id=2,</span>
<span class=sd>...                     customer_id=2, product_id=1, amount=1, measure=False),</span>
<span class=sd>...              Demand(arrival=4000, deadline=5000, demand_id=3,</span>
<span class=sd>...                     customer_id=3, product_id=1, amount=1, measure=True)],</span>
<span class=sd>...     warehous_at_t0=[0, 0],</span>
<span class=sd>...     station_product_unit_times=[[[10.0, 50.0, 15.0, 100.0],</span>
<span class=sd>...                                  [ 5.0, 20.0,  7.0,  35.0, 4.0, 50.0]],</span>
<span class=sd>...                                 [[ 5.0, 24.0,  7.0,  80.0],</span>
<span class=sd>...                                  [ 3.0, 21.0,  6.0,  50.0,]]])</span>
<span class=sd>>>> rop_sim = ROPSimulation(instance, PrintingListener(print_time=False))</span>
<span class=sd>>>> rop_sim.set_rop((10, 20))</span>
<span class=sd>>>> rop_sim.ctrl_run()</span>
<span class=sd>start</span>
<span class=sd>T=0.0: product=0, amount=0, in_warehouse=0, in_production=0, 0 pending demands</span>
<span class=sd>T=0.0: station=0, 1 jobs queued</span>
<span class=sd>T=0.0: start j(id: 0, p: 0, am: 11, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=0.0: product=1, amount=0, in_warehouse=0, in_production=0, 0 pending demands</span>
<span class=sd>T=0.0: station=1, 1 jobs queued</span>
<span class=sd>T=0.0: start j(id: 1, p: 1, am: 21, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=84.0: finished j(id: 1, p: 1, am: 21, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=100.0: product=0, amount=0, in_warehouse=0, in_production=11,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=130.0: finished j(id: 0, p: 0, am: 11, ar: 0, me: F, c: F, st: 0,\</span>
<span class=sd> sp: 0) at station 0</span>
<span class=sd>T=130.0: station=0, 2 jobs queued</span>
<span class=sd>T=130.0: start j(id: 1, p: 1, am: 21, ar: 0, me: F, c: F, st: 84,\</span>
<span class=sd> sp: 1) at station 0</span>
<span class=sd>T=130.0: station=1, 1 jobs queued</span>
<span class=sd>T=130.0: start j(id: 0, p: 0, am: 11, ar: 0, me: F, c: F, st: 130,\</span>
<span class=sd> sp: 1) at station 1</span>
<span class=sd>T=197.0: finished j(id: 0, p: 0, am: 11, ar: 0, me: F, c: T, st: 130,\</span>
<span class=sd> sp: 1) at station 1</span>
<span class=sd>T=197.0: product=0, amount=11, in_warehouse=0, in_production=1,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=197.0: d(id: 0, p: 0, c: 0, am: 1, ar: 100, dl: 100, me: F) statisfied</span>
<span class=sd>T=197.0: 10 units of product 0 in warehouse</span>
<span class=sd>T=240.0: finished j(id: 1, p: 1, am: 21, ar: 0, me: F, c: T, st: 84,\</span>
<span class=sd> sp: 1) at station 0</span>
<span class=sd>T=240.0: station=0, 1 jobs queued</span>
<span class=sd>T=240.0: start j(id: 2, p: 0, am: 1, ar: 100, me: F, c: F, st: 100,\</span>
<span class=sd> sp: 0) at station 0</span>
<span class=sd>T=240.0: product=1, amount=21, in_warehouse=0, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=240.0: 21 units of product 1 in warehouse</span>
<span class=sd>T=250.0: finished j(id: 2, p: 0, am: 1, ar: 100, me: F, c: F, st: 100,\</span>
<span class=sd> sp: 0) at station 0</span>
<span class=sd>T=250.0: station=1, 1 jobs queued</span>
<span class=sd>T=250.0: start j(id: 2, p: 0, am: 1, ar: 100, me: F, c: F, st: 250, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=255.0: finished j(id: 2, p: 0, am: 1, ar: 100, me: F, c: T, st: 250, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=255.0: product=0, amount=1, in_warehouse=10, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=255.0: 11 units of product 0 in warehouse</span>
<span class=sd>T=500.0: product=1, amount=0, in_warehouse=21, in_production=0,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=500.0: d(id: 2, p: 1, c: 2, am: 1, ar: 500, dl: 500, me: F) statisfied</span>
<span class=sd>T=500.0: 20 units of product 1 in warehouse</span>
<span class=sd>T=500.0: station=1, 1 jobs queued</span>
<span class=sd>T=500.0: start j(id: 3, p: 1, am: 1, ar: 500, me: F, c: F, st: 500,\</span>
<span class=sd> sp: 0) at station 1</span>
<span class=sd>T=503.0: finished j(id: 3, p: 1, am: 1, ar: 500, me: F, c: F, st: 500,\</span>
<span class=sd> sp: 0) at station 1</span>
<span class=sd>T=503.0: station=0, 1 jobs queued</span>
<span class=sd>T=503.0: start j(id: 3, p: 1, am: 1, ar: 500, me: F, c: F, st: 503,\</span>
<span class=sd> sp: 1) at station 0</span>
<span class=sd>T=508.0: finished j(id: 3, p: 1, am: 1, ar: 500, me: F, c: T, st: 503,\</span>
<span class=sd> sp: 1) at station 0</span>
<span class=sd>T=508.0: product=1, amount=1, in_warehouse=20, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=508.0: 21 units of product 1 in warehouse</span>
<span class=sd>T=3100.0! product=0, amount=0, in_warehouse=11, in_production=0,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=3100.0! d(id: 1, p: 0, c: 1, am: 1, ar: 3100, dl: 3100, me: T) statisfied</span>
<span class=sd>T=3100.0! 10 units of product 0 in warehouse</span>
<span class=sd>T=3100.0! station=0, 1 jobs queued</span>
<span class=sd>T=3100.0! start j(id: 4, p: 0, am: 1, ar: 3100, me: T, c: F, st: 3100,\</span>
<span class=sd> sp: 0) at station 0</span>
<span class=sd>T=3110.0! finished j(id: 4, p: 0, am: 1, ar: 3100, me: T, c: F, st: 3100,\</span>
<span class=sd> sp: 0) at station 0</span>
<span class=sd>T=3110.0! station=1, 1 jobs queued</span>
<span class=sd>T=3110.0! start j(id: 4, p: 0, am: 1, ar: 3100, me: T, c: F, st: 3110,\</span>
<span class=sd> sp: 1) at station 1</span>
<span class=sd>T=3117.0! finished j(id: 4, p: 0, am: 1, ar: 3100, me: T, c: T, st: 3110,\</span>
<span class=sd> sp: 1) at station 1</span>
<span class=sd>T=3117.0! product=0, amount=1, in_warehouse=10, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=3117.0! 11 units of product 0 in warehouse</span>
<span class=sd>T=4000.0! product=1, amount=0, in_warehouse=21, in_production=0,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=4000.0! d(id: 3, p: 1, c: 3, am: 1, ar: 4000, dl: 5000, me: T) statisfied</span>
<span class=sd>T=4000.0! 20 units of product 1 in warehouse</span>
<span class=sd>T=4000.0! station=1, 1 jobs queued</span>
<span class=sd>T=4000.0! start j(id: 5, p: 1, am: 1, ar: 4000, me: T, c: F, st: 4000,\</span>
<span class=sd> sp: 0) at station 1</span>
<span class=sd>T=4003.0! finished j(id: 5, p: 1, am: 1, ar: 4000, me: T, c: F, st: 4000,\</span>
<span class=sd> sp: 0) at station 1</span>
<span class=sd>T=4003.0! station=0, 1 jobs queued</span>
<span class=sd>T=4003.0! start j(id: 5, p: 1, am: 1, ar: 4000, me: T, c: F, st: 4003,\</span>
<span class=sd> sp: 1) at station 0</span>
<span class=sd>T=4008.0! finished j(id: 5, p: 1, am: 1, ar: 4000, me: T, c: T, st: 4003,\</span>
<span class=sd> sp: 1) at station 0</span>
<span class=sd>T=4008.0! product=1, amount=1, in_warehouse=20, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=4008.0! 21 units of product 1 in warehouse</span>
<span class=sd>T=4008.0 -- finished</span>

<span class=sd>>>> instance = Instance(</span>
<span class=sd>...     name="test2", n_products=2, n_customers=1, n_stations=2, n_demands=5,</span>
<span class=sd>...     time_end_warmup=21, time_end_measure=10000,</span>
<span class=sd>...     routes=[[0, 1], [1, 0]],</span>
<span class=sd>...     demands=[[0, 0, 1, 4, 20, 90], [1, 0, 0, 5, 22, 200],</span>
<span class=sd>...              [2, 0, 1, 4, 30, 200], [3, 0, 1, 6, 60, 200],</span>
<span class=sd>...              [4, 0, 0, 3, 5, 2000]],</span>
<span class=sd>...     warehous_at_t0=[2, 1],</span>
<span class=sd>...     station_product_unit_times=[[[10.0, 50.0, 15.0, 100.0],</span>
<span class=sd>...                                  [ 5.0, 20.0,  7.0,  35.0, 4.0, 50.0]],</span>
<span class=sd>...                                 [[ 5.0, 24.0,  7.0,  80.0],</span>
<span class=sd>...                                  [ 3.0, 21.0,  6.0,  50.0,]]])</span>
<span class=sd>>>> rop_sim = ROPSimulation(instance, PrintingListener(print_time=False))</span>
<span class=sd>>>> rop_sim.set_rop((10, 10))</span>
<span class=sd>>>> rop_sim.ctrl_run()</span>
<span class=sd>start</span>
<span class=sd>T=0.0: product=0, amount=2, in_warehouse=0, in_production=0, 0 pending demands</span>
<span class=sd>T=0.0: 2 units of product 0 in warehouse</span>
<span class=sd>T=0.0: station=0, 1 jobs queued</span>
<span class=sd>T=0.0: start j(id: 0, p: 0, am: 9, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=0.0: product=1, amount=1, in_warehouse=0, in_production=0, 0 pending demands</span>
<span class=sd>T=0.0: 1 units of product 1 in warehouse</span>
<span class=sd>T=0.0: station=1, 1 jobs queued</span>
<span class=sd>T=0.0: start j(id: 1, p: 1, am: 10, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=5.0: product=0, amount=0, in_warehouse=2, in_production=9, 1 pending demands</span>
<span class=sd>T=20.0: product=1, amount=0, in_warehouse=1, in_production=10,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=22.0! product=0, amount=0, in_warehouse=2, in_production=12,\</span>
<span class=sd> 2 pending demands</span>
<span class=sd>T=30.0! product=1, amount=0, in_warehouse=1, in_production=14,\</span>
<span class=sd> 2 pending demands</span>
<span class=sd>T=39.0: finished j(id: 1, p: 1, am: 10, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=39.0! station=1, 2 jobs queued</span>
<span class=sd>T=39.0: start j(id: 3, p: 1, am: 4, ar: 20, me: F, c: F, st: 20, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=57.0: finished j(id: 3, p: 1, am: 4, ar: 20, me: F, c: F, st: 20, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=57.0! station=1, 1 jobs queued</span>
<span class=sd>T=57.0! start j(id: 5, p: 1, am: 4, ar: 30, me: T, c: F, st: 30, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=60.0! product=1, amount=0, in_warehouse=1, in_production=18,\</span>
<span class=sd> 3 pending demands</span>
<span class=sd>T=69.0! finished j(id: 5, p: 1, am: 4, ar: 30, me: T, c: F, st: 30, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=69.0! station=1, 1 jobs queued</span>
<span class=sd>T=69.0! start j(id: 6, p: 1, am: 6, ar: 60, me: T, c: F, st: 60, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=102.0! finished j(id: 6, p: 1, am: 6, ar: 60, me: T, c: F, st: 60, sp: 0)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=110.0: finished j(id: 0, p: 0, am: 9, ar: 0, me: F, c: F, st: 0, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=110.0! station=0, 6 jobs queued</span>
<span class=sd>T=110.0: start j(id: 2, p: 0, am: 3, ar: 5, me: F, c: F, st: 5, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=110.0! station=1, 1 jobs queued</span>
<span class=sd>T=110.0: start j(id: 0, p: 0, am: 9, ar: 0, me: F, c: F, st: 110, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=140.0: finished j(id: 2, p: 0, am: 3, ar: 5, me: F, c: F, st: 5, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=140.0! station=0, 5 jobs queued</span>
<span class=sd>T=140.0! start j(id: 4, p: 0, am: 5, ar: 22, me: T, c: F, st: 22, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=171.0: finished j(id: 0, p: 0, am: 9, ar: 0, me: F, c: T, st: 110, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=171.0! station=1, 1 jobs queued</span>
<span class=sd>T=171.0: start j(id: 2, p: 0, am: 3, ar: 5, me: F, c: F, st: 140, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=171.0! product=0, amount=9, in_warehouse=2, in_production=8,\</span>
<span class=sd> 2 pending demands</span>
<span class=sd>T=171.0: d(id: 4, p: 0, c: 0, am: 3, ar: 5, dl: 2000, me: F) statisfied</span>
<span class=sd>T=171.0! d(id: 1, p: 0, c: 0, am: 5, ar: 22, dl: 200, me: T) statisfied</span>
<span class=sd>T=171.0! 3 units of product 0 in warehouse</span>
<span class=sd>T=186.0: finished j(id: 2, p: 0, am: 3, ar: 5, me: F, c: T, st: 140, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=186.0! product=0, amount=3, in_warehouse=3, in_production=5,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=186.0! 6 units of product 0 in warehouse</span>
<span class=sd>T=210.0! finished j(id: 4, p: 0, am: 5, ar: 22, me: T, c: F, st: 22, sp: 0)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=210.0! station=0, 4 jobs queued</span>
<span class=sd>T=210.0: start j(id: 1, p: 1, am: 10, ar: 0, me: F, c: F, st: 39, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=210.0! station=1, 1 jobs queued</span>
<span class=sd>T=210.0! start j(id: 4, p: 0, am: 5, ar: 22, me: T, c: F, st: 210, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=245.0! finished j(id: 4, p: 0, am: 5, ar: 22, me: T, c: T, st: 210, sp: 1)\</span>
<span class=sd> at station 1</span>
<span class=sd>T=245.0! product=0, amount=5, in_warehouse=6, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=245.0! 11 units of product 0 in warehouse</span>
<span class=sd>T=263.0: finished j(id: 1, p: 1, am: 10, ar: 0, me: F, c: T, st: 39, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=263.0! station=0, 3 jobs queued</span>
<span class=sd>T=263.0: start j(id: 3, p: 1, am: 4, ar: 20, me: F, c: F, st: 57, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=263.0! product=1, amount=10, in_warehouse=1, in_production=14,\</span>
<span class=sd> 3 pending demands</span>
<span class=sd>T=263.0: d(id: 0, p: 1, c: 0, am: 4, ar: 20, dl: 90, me: F) statisfied</span>
<span class=sd>T=263.0! d(id: 2, p: 1, c: 0, am: 4, ar: 30, dl: 200, me: T) statisfied</span>
<span class=sd>T=263.0! 3 units of product 1 in warehouse</span>
<span class=sd>T=287.0: finished j(id: 3, p: 1, am: 4, ar: 20, me: F, c: T, st: 57, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=287.0! station=0, 2 jobs queued</span>
<span class=sd>T=287.0! start j(id: 5, p: 1, am: 4, ar: 30, me: T, c: F, st: 69, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=287.0! product=1, amount=4, in_warehouse=3, in_production=10,\</span>
<span class=sd> 1 pending demands</span>
<span class=sd>T=287.0! d(id: 3, p: 1, c: 0, am: 6, ar: 60, dl: 200, me: T) statisfied</span>
<span class=sd>T=287.0! 1 units of product 1 in warehouse</span>
<span class=sd>T=303.0! finished j(id: 5, p: 1, am: 4, ar: 30, me: T, c: T, st: 69, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=303.0! station=0, 1 jobs queued</span>
<span class=sd>T=303.0! start j(id: 6, p: 1, am: 6, ar: 60, me: T, c: F, st: 102, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=303.0! product=1, amount=4, in_warehouse=1, in_production=6,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=303.0! 5 units of product 1 in warehouse</span>
<span class=sd>T=337.0! finished j(id: 6, p: 1, am: 6, ar: 60, me: T, c: T, st: 102, sp: 1)\</span>
<span class=sd> at station 0</span>
<span class=sd>T=337.0! product=1, amount=6, in_warehouse=5, in_production=0,\</span>
<span class=sd> 0 pending demands</span>
<span class=sd>T=337.0! 11 units of product 1 in warehouse</span>
<span class=sd>T=337.0 -- finished</span>
<span class=sd>"""</span>

<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Final</span><span class=p>,</span> <span class=n>Iterable</span>

<span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.types</span><span class=w> </span><span class=kn>import</span> <span class=n>check_int_range</span><span class=p>,</span> <span class=n>type_error</span>

<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.prodsched.instance</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>Demand</span><span class=p>,</span>
    <span class=n>Instance</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.prodsched.simulation</span><span class=w> </span><span class=kn>import</span> <span class=n>Listener</span><span class=p>,</span> <span class=n>Simulation</span>


<div class=viewcode-block id=ROPSimulation>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.rop_simulation.ROPSimulation>[docs]</a>
<span class=k>class</span><span class=w> </span><span class=nc>ROPSimulation</span><span class=p>(</span><span class=n>Simulation</span><span class=p>):</span>
<span class=w>    </span><span class=sd>"""Create the re-order point-based simulation."""</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>:</span> <span class=n>Instance</span><span class=p>,</span> <span class=n>listener</span><span class=p>:</span> <span class=n>Listener</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Initialize this simulation.</span>

<span class=sd>        :param instance: the instance</span>
<span class=sd>        :param listener: the listener</span>
<span class=sd>        """</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>listener</span><span class=p>)</span>
        <span class=c1>#: the re-order point</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__rop</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>instance</span><span class=o>.</span><span class=n>n_products</span>

<div class=viewcode-block id=ROPSimulation.set_rop>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.rop_simulation.ROPSimulation.set_rop>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>set_rop</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rop</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>|</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Set the re-order point.</span>

<span class=sd>        :param rop: the re-order point</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>rop</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>):</span>
            <span class=n>rop</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=n>rop</span><span class=p>)</span>  <span class=c1># type: ignore</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>rop</span><span class=p>,</span> <span class=n>Iterable</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=n>rop</span><span class=p>,</span> <span class=s2>"rop"</span><span class=p>,</span> <span class=n>Iterable</span><span class=p>)</span>
        <span class=n>i</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>rv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>rop</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__rop</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>check_int_range</span><span class=p>(</span>
                <span class=n>rv</span><span class=p>,</span> <span class=s2>"rop-value"</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1_000_000_000</span><span class=p>)</span>
        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=n>n_prod</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=o>.</span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__rop</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=n>n_prod</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Invalid rop length </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>, must be </span><span class=si>{</span><span class=n>n_prod</span><span class=si>}</span><span class=s2>!"</span><span class=p>)</span></div>


<div class=viewcode-block id=ROPSimulation.event_product>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.rop_simulation.ROPSimulation.event_product>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>event_product</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>  <span class=c1># pylint: disable=W0613,R0913,R0917</span>
                      <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
                      <span class=n>in_warehouse</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
                      <span class=n>in_production</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>  <span class=c1># pylint: disable=W0613</span>
                      <span class=n>pending_demands</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>[</span><span class=n>Demand</span><span class=p>,</span> <span class=o>...</span><span class=p>])</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""Perform a simulation step based on a product."""</span>
        <span class=c1># satisfy demands</span>
        <span class=n>available</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>in_warehouse</span> <span class=o>+</span> <span class=n>amount</span>
        <span class=n>unsatisfied</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>demand</span> <span class=ow>in</span> <span class=n>pending_demands</span><span class=p>:</span>
            <span class=n>request</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>demand</span><span class=o>.</span><span class=n>amount</span>
            <span class=k>if</span> <span class=n>request</span> <span class=o><=</span> <span class=n>available</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>act_demand_satisfied</span><span class=p>(</span><span class=n>demand</span><span class=p>)</span>
                <span class=n>available</span> <span class=o>-=</span> <span class=n>request</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>unsatisfied</span> <span class=o>+=</span> <span class=n>request</span>

        <span class=c1># update warehouse</span>
        <span class=k>if</span> <span class=n>available</span> <span class=o><</span> <span class=n>in_warehouse</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>act_take_from_warehouse</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>in_warehouse</span> <span class=o>-</span> <span class=n>available</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>available</span> <span class=o>></span> <span class=n>in_warehouse</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>act_store_in_warehouse</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>available</span> <span class=o>-</span> <span class=n>in_warehouse</span><span class=p>)</span>

        <span class=c1># check if re-order point needs to be triggered</span>
        <span class=n>rop</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__rop</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span>
        <span class=n>available</span> <span class=o>=</span> <span class=n>available</span> <span class=o>-</span> <span class=n>unsatisfied</span> <span class=o>+</span> <span class=n>in_production</span>
        <span class=k>if</span> <span class=n>available</span> <span class=o><=</span> <span class=n>rop</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>act_produce</span><span class=p>(</span><span class=n>product_id</span><span class=p>,</span> <span class=n>rop</span> <span class=o>-</span> <span class=n>available</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span></div>
</div>

</pre></div><div class=clearer></div></div></div></div><div aria-label=Main class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><search id=searchbox role=search style=display:none> <h3 id=searchlabel>Quick search</h3> <div class=searchformwrapper><form action=../../../search.html class=search><input aria-labelledby=searchlabel autocapitalize=off autocomplete=off autocorrect=off name=q spellcheck=false><input type=submit value=Go></form></div> </search><script>document.getElementById(`searchbox`).style.display=`block`;</script></div></div><div class=clearer></div></div><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"href=../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../index.html>moptipyapps 0.8.79 documentation</a> »<li class="nav-item nav-item-1"><a href=../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>moptipyapps.prodsched.rop_simulation</a></ul></div><div class=footer role=contentinfo>© Copyright 2023-2025, Thomas Weise.</div>
