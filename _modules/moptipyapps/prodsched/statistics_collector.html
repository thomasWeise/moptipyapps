<!doctype html><html data-content_root=../../../ lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0"name=viewport><title>moptipyapps.prodsched.statistics_collector — moptipyapps 0.8.79 documentation</title><link href="../../../_static/pygments.css?v=b86133f3"rel=stylesheet><link href="../../../_static/bizstyle.css?v=5283bb3d"rel=stylesheet><script src="../../../_static/documentation_options.js?v=38375235"></script><script src="../../../_static/doctools.js?v=9bcbadda"></script><script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script><script src=../../../_static/bizstyle.js></script><link href=https://thomasweise.github.io/moptipyapps/_modules/moptipyapps/prodsched/statistics_collector.html rel=canonical><link href=../../../genindex.html rel=index title=Index><link href=../../../search.html rel=search title=Search><meta content="width=device-width,initial-scale=1.0"name=viewport><body><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"accesskey=I href=../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../index.html>moptipyapps 0.8.79 documentation</a> »<li class="nav-item nav-item-1"><a accesskey=U href=../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>moptipyapps.prodsched.statistics_collector</a></ul></div><div class=document><div class=documentwrapper><div class=bodywrapper><div class=body role=main><h1>Source code for moptipyapps.prodsched.statistics_collector</h1><div class=highlight><pre>
<span></span><span class=sa>r</span><span class=sd>"""</span>
<span class=sd>A tool for collecting statistics from an MFC simulation.</span>

<span class=sd>A statistics collector :class:`~StatisticsCollector` is a special</span>
<span class=sd>:class:`~moptipyapps.prodsched.simulation.Listener`</span>
<span class=sd>that can be plugged into a</span>
<span class=sd>:class:`~moptipyapps.prodsched.simulation.Simulation`.</span>
<span class=sd>During the execution of the simulation, it gathers statistics about what is</span>
<span class=sd>going on. It finally stores these into a</span>
<span class=sd>:class:`~moptipyapps.prodsched.statistics.Statistics` record.</span>
<span class=sd>Such a record can then be used to understand the key characteristics of the</span>
<span class=sd>behavior of the simulation in on a given</span>
<span class=sd>:class:`~moptipyapps.prodsched.instance.Instance`.</span>

<span class=sd>The simulation listeners (:class:`~moptipyapps.prodsched.simulation.Listener`)</span>
<span class=sd>offer a method to pipe out data from arbitrary subclasses of</span>
<span class=sd>:class:`~moptipyapps.prodsched.simulation.Simulation`.</span>
<span class=sd>This means that they allow us to access data in a unified way, regardless of</span>
<span class=sd>which manufacturing logic or production scheduling we actually implement.</span>

<span class=sd>In the case of the :class:`~StatisticsCollector` implemented here, we</span>
<span class=sd>implement the :class:`~moptipyapps.prodsched.simulation.Listener`-API to</span>
<span class=sd>fill a :class:`~moptipyapps.prodsched.statistics.Statistics` record with data.</span>
<span class=sd>Such records offer the standard statistics that Thürer et al. used in their</span>
<span class=sd>works.</span>
<span class=sd>In other words, we can make such statistics available and accessible,</span>
<span class=sd>regardless of how our simulation schedules the production.</span>

<span class=sd>Moreover, multiple such :class:`~moptipyapps.prodsched.statistics.Statistics`</span>
<span class=sd>records, filled with data from simulations over multiple different instances</span>
<span class=sd>(:mod:`~moptipyapps.prodsched.instance`) can be combined in a</span>
<span class=sd>:class:`~moptipyapps.prodsched.multistatistics.MultiStatistics` record.</span>
<span class=sd>This record, which will comprehensively represent performance over several</span>
<span class=sd>independent instances, then can be used as basis for objective functions</span>
<span class=sd>(:class:`~moptipy.api.objective.Objective`) such as those given in</span>
<span class=sd>:mod:`~moptipyapps.prodsched.objectives`.</span>

<span class=sd>>>> instance = Instance(</span>
<span class=sd>...     name="test2", n_products=2, n_customers=1, n_stations=2, n_demands=5,</span>
<span class=sd>...     time_end_warmup=21, time_end_measure=10000,</span>
<span class=sd>...     routes=[[0, 1], [1, 0]],</span>
<span class=sd>...     demands=[[0, 0, 1, 10, 20, 90], [1, 0, 0, 5, 22, 200],</span>
<span class=sd>...              [2, 0, 1, 7, 30, 200], [3, 0, 1, 6, 60, 200],</span>
<span class=sd>...              [4, 0, 0, 125, 5, 2000]],</span>
<span class=sd>...     warehous_at_t0=[2, 1],</span>
<span class=sd>...     station_product_unit_times=[[[10.0, 50.0, 15.0, 100.0],</span>
<span class=sd>...                                  [ 5.0, 20.0,  7.0,  35.0, 4.0, 50.0]],</span>
<span class=sd>...                                 [[ 5.0, 24.0,  7.0,  80.0],</span>
<span class=sd>...                                  [ 3.0, 21.0,  6.0,  50.0,]]])</span>


<span class=sd>>>> from moptipyapps.prodsched.simulation import Simulation</span>
<span class=sd>>>> statistics = Statistics(instance.n_products)</span>
<span class=sd>>>> collector = StatisticsCollector(instance)</span>
<span class=sd>>>> collector.set_dest(statistics)</span>
<span class=sd>>>> simulation = Simulation(instance, collector)</span>
<span class=sd>>>> simulation.ctrl_run()</span>
<span class=sd>>>> print("\n".join(str(statistics).split("\n")[:-1]))</span>
<span class=sd>stat;total;product_0;product_1</span>
<span class=sd>trp.min;229.57142857142858;455.6;229.57142857142858</span>
<span class=sd>trp.mean;304.8888888888889;455.6;246.92307692307693</span>
<span class=sd>trp.max;455.6;455.6;267.1666666666667</span>
<span class=sd>trp.sd;97.56326157594913;0;19.50721118346466</span>
<span class=sd>cwt.min;1603;2278;1603</span>
<span class=sd>cwt.mean;1829.3333333333333;2278;1605</span>
<span class=sd>cwt.max;2278;2278;1607</span>
<span class=sd>cwt.sd;388.56187838403986;;2.8284271247461903</span>
<span class=sd>fill.rate;0;0;0</span>
<span class=sd>stocklevel.mean;0.6078765407355446;0.4497444633730835;0.15813207736246118</span>
<span class=sd>fulfilled.rate;1;1;1</span>
<span class=sd>"""</span>

<span class=kn>from</span><span class=w> </span><span class=nn>time</span><span class=w> </span><span class=kn>import</span> <span class=n>time_ns</span>
<span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Final</span>

<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.math.stream_statistics</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>StreamStatistics</span><span class=p>,</span>
    <span class=n>StreamStatisticsAggregate</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.math.streams</span><span class=w> </span><span class=kn>import</span> <span class=n>StreamSum</span>
<span class=kn>from</span><span class=w> </span><span class=nn>pycommons.types</span><span class=w> </span><span class=kn>import</span> <span class=n>type_error</span>

<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.prodsched.instance</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>Demand</span><span class=p>,</span>
    <span class=n>Instance</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.prodsched.simulation</span><span class=w> </span><span class=kn>import</span> <span class=n>Job</span><span class=p>,</span> <span class=n>Listener</span>
<span class=kn>from</span><span class=w> </span><span class=nn>moptipyapps.prodsched.statistics</span><span class=w> </span><span class=kn>import</span> <span class=n>Statistics</span>


<div class=viewcode-block id=StatisticsCollector>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector>[docs]</a>
<span class=k>class</span><span class=w> </span><span class=nc>StatisticsCollector</span><span class=p>(</span><span class=n>Listener</span><span class=p>):</span>
<span class=w>    </span><span class=sd>"""A listener for simulation events that collects basic statistics."""</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>:</span> <span class=n>Instance</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Initialize the listener.</span>

<span class=sd>        :param instance: the instance</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>Instance</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=s2>"instance"</span><span class=p>,</span> <span class=n>Instance</span><span class=p>)</span>
        <span class=c1>#: the destination to write to.</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__dest</span><span class=p>:</span> <span class=n>Statistics</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=c1>#: the end of the warmup period</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__warmup</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>time_end_warmup</span>
        <span class=c1>#: the total time window length</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__total</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>time_end_measure</span>
        <span class=c1>#: the number of products</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__n_products</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>n_products</span>
        <span class=c1>#: the measurable demands per product</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__n_mdpb</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>instance</span><span class=o>.</span><span class=n>n_measurable_demands_per_product</span><span class=p>)</span>

        <span class=n>n_products</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=n>n_products</span>
        <span class=c1>#: the internal per-product production time records</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__production_times</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span>
            <span class=n>StreamStatisticsAggregate</span><span class=p>[</span><span class=n>StreamStatistics</span><span class=p>],</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
            <span class=n>StreamStatistics</span><span class=o>.</span><span class=n>aggregate</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_products</span><span class=p>))</span>
        <span class=c1>#: the internal total production time</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__production_time</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>StreamStatisticsAggregate</span><span class=p>[</span>
            <span class=n>StreamStatistics</span><span class=p>]]</span> <span class=o>=</span> <span class=n>StreamStatistics</span><span class=o>.</span><span class=n>aggregate</span><span class=p>()</span>
        <span class=c1>#: the immediately satisfied products: satisfied vs. total</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__immediately_satisfied</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>n_products</span>
        <span class=c1>#: the statistics of the waiting time for not-immediately satisfied</span>
        <span class=c1>#: products, per product</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_times</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span>
            <span class=n>StreamStatisticsAggregate</span><span class=p>[</span><span class=n>StreamStatistics</span><span class=p>],</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
            <span class=n>StreamStatistics</span><span class=o>.</span><span class=n>aggregate</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_products</span><span class=p>))</span>
        <span class=c1>#: the total waiting time for non-immediately satisfied products</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_time</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>StreamStatisticsAggregate</span><span class=p>[</span>
            <span class=n>StreamStatistics</span><span class=p>]]</span> <span class=o>=</span> <span class=n>StreamStatistics</span><span class=o>.</span><span class=n>aggregate</span><span class=p>()</span>
        <span class=c1>#: the number of fulfilled jobs, per-product</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__fulfilled</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>n_products</span>
        <span class=c1>#: the stock levels on a per-product basis</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__stock_levels</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=n>StreamSum</span><span class=p>,</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span>
            <span class=n>StreamSum</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_products</span><span class=p>))</span>
        <span class=c1>#: the total stock level sum</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__stock_level</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>StreamSum</span><span class=p>]</span> <span class=o>=</span> <span class=n>StreamSum</span><span class=p>()</span>
        <span class=c1>#: the number of products currently in warehouse and since when</span>
        <span class=c1>#: they were there</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__in_warehouse</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>float</span><span class=p>],</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>([</span>
            <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_products</span><span class=p>))</span>
        <span class=c1>#: the stat time of the simulation</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__start</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>

<div class=viewcode-block id=StatisticsCollector.set_dest>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector.set_dest>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>set_dest</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dest</span><span class=p>:</span> <span class=n>Statistics</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Set the statistics record to fill.</span>

<span class=sd>        :param dest: the destination</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>dest</span><span class=p>,</span> <span class=n>Statistics</span><span class=p>):</span>
            <span class=k>raise</span> <span class=n>type_error</span><span class=p>(</span><span class=n>dest</span><span class=p>,</span> <span class=s2>"dest"</span><span class=p>,</span> <span class=n>Statistics</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__dest</span> <span class=o>=</span> <span class=n>dest</span></div>


<div class=viewcode-block id=StatisticsCollector.start>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector.start>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""Clear all the data of the collector."""</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__dest</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"Need destination statistics!"</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__start</span> <span class=o>=</span> <span class=n>time_ns</span><span class=p>()</span>
        <span class=n>n_products</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__n_products</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_products</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__production_times</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__immediately_satisfied</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_times</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__fulfilled</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__stock_levels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
            <span class=n>wh</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__in_warehouse</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>wh</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.0</span>
            <span class=n>wh</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.0</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__production_time</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_time</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__stock_level</span><span class=o>.</span><span class=n>reset</span><span class=p>()</span></div>


<div class=viewcode-block id=StatisticsCollector.product_in_warehouse>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector.product_in_warehouse>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>product_in_warehouse</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span> <span class=n>time</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>product_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
            <span class=n>is_in_measure_period</span><span class=p>:</span> <span class=nb>bool</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Report a change of the amount of products in the warehouse.</span>

<span class=sd>        :param time: the current time</span>
<span class=sd>        :param product_id: the product ID</span>
<span class=sd>        :param amount: the new absolute total amount of that product in the</span>
<span class=sd>            warehouse</span>
<span class=sd>        :param is_in_measure_period: is this event inside the measurement</span>
<span class=sd>            period?</span>
<span class=sd>        """</span>
        <span class=n>iwh</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>float</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__in_warehouse</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>is_in_measure_period</span><span class=p>:</span>
            <span class=n>value</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span> <span class=o>-</span> <span class=nb>max</span><span class=p>(</span><span class=n>iwh</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>__warmup</span><span class=p>))</span> <span class=o>*</span> <span class=n>iwh</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__stock_levels</span><span class=p>[</span><span class=n>product_id</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__stock_level</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
        <span class=n>iwh</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>amount</span>
        <span class=n>iwh</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span></div>


<div class=viewcode-block id=StatisticsCollector.produce_at_end>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector.produce_at_end>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>produce_at_end</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span> <span class=n>time</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>station_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>job</span><span class=p>:</span> <span class=n>Job</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Report the completion of the production of a product at a station.</span>

<span class=sd>        :param time: the current time</span>
<span class=sd>        :param station_id: the station ID</span>
<span class=sd>        :param job: the production job</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=n>job</span><span class=o>.</span><span class=n>measure</span> <span class=ow>and</span> <span class=n>job</span><span class=o>.</span><span class=n>completed</span><span class=p>:</span>
            <span class=n>am</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>job</span><span class=o>.</span><span class=n>amount</span>
            <span class=n>tt</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>time</span> <span class=o>-</span> <span class=n>job</span><span class=o>.</span><span class=n>arrival</span>
            <span class=k>if</span> <span class=n>am</span> <span class=o><=</span> <span class=mi>1</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__production_times</span><span class=p>[</span><span class=n>job</span><span class=o>.</span><span class=n>product_id</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tt</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__production_time</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tt</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>  <span class=c1># deal with amounts > 1</span>
                <span class=n>tt</span> <span class=o>/=</span> <span class=n>am</span>
                <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>am</span><span class=p>):</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>__production_times</span><span class=p>[</span><span class=n>job</span><span class=o>.</span><span class=n>product_id</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tt</span><span class=p>)</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>__production_time</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tt</span><span class=p>)</span></div>


<div class=viewcode-block id=StatisticsCollector.demand_satisfied>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector.demand_satisfied>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>demand_satisfied</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span> <span class=n>time</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>demand</span><span class=p>:</span> <span class=n>Demand</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Report that a given demand has been satisfied.</span>

<span class=sd>        :param time: the time index when the demand was satisfied</span>
<span class=sd>        :param demand: the demand that was satisfied</span>
<span class=sd>        """</span>
        <span class=k>if</span> <span class=n>demand</span><span class=o>.</span><span class=n>measure</span><span class=p>:</span>
            <span class=n>at</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>demand</span><span class=o>.</span><span class=n>arrival</span>
            <span class=n>pid</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>demand</span><span class=o>.</span><span class=n>product_id</span>
            <span class=k>if</span> <span class=n>at</span> <span class=o>>=</span> <span class=n>time</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__immediately_satisfied</span><span class=p>[</span><span class=n>pid</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>tt</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span> <span class=o>-</span> <span class=n>at</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_times</span><span class=p>[</span><span class=n>pid</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tt</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_time</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>tt</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>__fulfilled</span><span class=p>[</span><span class=n>pid</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span></div>


<div class=viewcode-block id=StatisticsCollector.finished>
<a class=viewcode-back href=../../../moptipyapps.prodsched.html#moptipyapps.prodsched.statistics_collector.StatisticsCollector.finished>[docs]</a>
    <span class=k>def</span><span class=w> </span><span class=nf>finished</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>time</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-></span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>"""</span>
<span class=sd>        Fill the collected statistics into the statistics record.</span>

<span class=sd>        :param time: the time when we are finished</span>
<span class=sd>        """</span>
        <span class=n>dest</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>Statistics</span> <span class=o>|</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__dest</span>
        <span class=k>if</span> <span class=n>dest</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"Lost destination statistics record?"</span><span class=p>)</span>
        <span class=n>total</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=o>...</span><span class=p>]]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__n_mdpb</span>

        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>stat</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__production_times</span><span class=p>):</span>
            <span class=n>dest</span><span class=o>.</span><span class=n>production_times</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>stat</span><span class=o>.</span><span class=n>result_or_none</span><span class=p>()</span>
        <span class=n>dest</span><span class=o>.</span><span class=n>production_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__production_time</span><span class=o>.</span><span class=n>result_or_none</span><span class=p>()</span>

        <span class=n>sn</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>sf</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>st</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>n</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__immediately_satisfied</span><span class=p>):</span>
            <span class=n>t</span> <span class=o>=</span> <span class=n>total</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>dest</span><span class=o>.</span><span class=n>immediate_rates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>n</span> <span class=o>/</span> <span class=n>t</span>
            <span class=n>sn</span> <span class=o>+=</span> <span class=n>n</span>
            <span class=n>f</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__fulfilled</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>dest</span><span class=o>.</span><span class=n>fulfilled_rates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>f</span> <span class=o>/</span> <span class=n>t</span>
            <span class=n>sf</span> <span class=o>+=</span> <span class=n>f</span>
            <span class=n>st</span> <span class=o>+=</span> <span class=n>t</span>
        <span class=n>dest</span><span class=o>.</span><span class=n>immediate_rate</span> <span class=o>=</span> <span class=n>sn</span> <span class=o>/</span> <span class=n>st</span>
        <span class=n>dest</span><span class=o>.</span><span class=n>fulfilled_rate</span> <span class=o>=</span> <span class=n>sf</span> <span class=o>/</span> <span class=n>st</span>

        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>stat</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__waiting_times</span><span class=p>):</span>
            <span class=n>dest</span><span class=o>.</span><span class=n>waiting_times</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>stat</span><span class=o>.</span><span class=n>result_or_none</span><span class=p>()</span>
        <span class=n>dest</span><span class=o>.</span><span class=n>waiting_time</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__waiting_time</span><span class=o>.</span><span class=n>result_or_none</span><span class=p>()</span>

        <span class=n>slm</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=n>StreamSum</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__stock_level</span>
        <span class=n>twl</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__total</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>__warmup</span>
        <span class=n>wu</span><span class=p>:</span> <span class=n>Final</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__warmup</span>
        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>sm</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__stock_levels</span><span class=p>):</span>
            <span class=n>wh</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__in_warehouse</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>v</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__total</span> <span class=o>-</span> <span class=nb>max</span><span class=p>(</span><span class=n>wh</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>wu</span><span class=p>))</span> <span class=o>*</span> <span class=n>wh</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
            <span class=n>sm</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
            <span class=n>slm</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
            <span class=n>dest</span><span class=o>.</span><span class=n>stock_levels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>sm</span><span class=o>.</span><span class=n>result</span><span class=p>()</span> <span class=o>/</span> <span class=n>twl</span>
        <span class=n>dest</span><span class=o>.</span><span class=n>stock_level</span> <span class=o>=</span> <span class=n>slm</span><span class=o>.</span><span class=n>result</span><span class=p>()</span> <span class=o>/</span> <span class=n>twl</span>
        <span class=n>dest</span><span class=o>.</span><span class=n>simulation_time_nanos</span> <span class=o>=</span> <span class=n>time_ns</span><span class=p>()</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>__start</span></div>
</div>

</pre></div><div class=clearer></div></div></div></div><div aria-label=Main class=sphinxsidebar role=navigation><div class=sphinxsidebarwrapper><search id=searchbox role=search style=display:none> <h3 id=searchlabel>Quick search</h3> <div class=searchformwrapper><form action=../../../search.html class=search><input aria-labelledby=searchlabel autocapitalize=off autocomplete=off autocorrect=off name=q spellcheck=false><input type=submit value=Go></form></div> </search><script>document.getElementById(`searchbox`).style.display=`block`;</script></div></div><div class=clearer></div></div><div aria-label=Related class=related role=navigation><h3>Navigation</h3><ul><li class=right style=margin-right:10px><a title="General Index"href=../../../genindex.html>index</a><li class=right><a title="Python Module Index"href=../../../py-modindex.html>modules</a> |<li class="nav-item nav-item-0"><a href=../../../index.html>moptipyapps 0.8.79 documentation</a> »<li class="nav-item nav-item-1"><a href=../../index.html>Module code</a> »<li class="nav-item nav-item-this"><a href>moptipyapps.prodsched.statistics_collector</a></ul></div><div class=footer role=contentinfo>© Copyright 2023-2025, Thomas Weise.</div>
